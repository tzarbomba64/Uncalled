<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uncalled README & Downloads Viewer</title>
  <style>
    body { background-color: #000; color: #fff; font-family: sans-serif; padding: 2rem; line-height: 1.6; }
    a { color: #00aaff; }
    h1, h2, h3, h4, h5, h6 { color: #00aaff; margin-top: 1.5em; }
    blockquote { border-left: 4px solid #00aaff; padding-left: 1rem; color: #ccc; }
    code { background-color: #111; padding: 0.2em 0.4em; border-radius: 4px; color: #00ffcc; }
    pre { background-color: #111; padding: 1em; border-radius: 4px; overflow: auto; }
    #downloads { margin-top: 2rem; }
    .download-btn { background-color: #00aaff; color: #fff; padding: 0.5em 1em; border: none; border-radius: 4px; margin: 0.5em; cursor: pointer; }
    .download-btn:hover { opacity: 0.8; }
    .error { margin-top: 2rem; padding: 1rem; background-color: #330000; border: 1px solid #ff0000; border-radius: 4px; color: #ff5555; }
  </style>
</head>
<body>
  <div id="content">Hold up, loading README...</div>
  <div id="downloads"><h2>Downloads</h2></div>
  <div id="error" class="error" style="display:none;"></div>

  <!-- Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.7.1/dist/jszip.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const owner = 'tzarbomba64';
      const repo = 'Uncalled';
      const branch = 'main';
      const readmeUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/README.md`;
      const listApiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/list?ref=${branch}`;

      const contentEl = document.getElementById('content');
      const downloadsEl = document.getElementById('downloads');
      const errorEl = document.getElementById('error');

      fetch(readmeUrl)
        .then(res => { if (!res.ok) throw new Error(res.status); return res.text(); })
        .then(md => {
          contentEl.innerHTML = marked.parse(md);
          listDownloads();
        })
        .catch(err => showError('Couldn\'t load README: ' + err.message));

      function showError(msg) {
        errorEl.style.display = 'block';
        errorEl.textContent = msg;
        console.error(msg);
      }

      function listDownloads() {
        fetch(listApiUrl, { headers: { 'Accept': 'application/vnd.github.v3+json' } })
          .then(res => { if (!res.ok) throw new Error(res.status); return res.json(); })
          .then(items => {
            if (!Array.isArray(items) || items.length === 0) {
              downloadsEl.insertAdjacentHTML('beforeend', '<p>No items in the list folder, chill vibes though.</p>');
              return;
            }
            items.forEach(item => {
              const btn = document.createElement('button');
              const name = item.name.replace(/\.[^/.]+$/, '');
              btn.textContent = `Download ${name}.zip`;
              btn.className = 'download-btn';
              btn.onclick = () => zipAndDownload(item);
              downloadsEl.appendChild(btn);
            });
          })
          .catch(err => showError('Couldn\'t fetch list folder: ' + err.message));
      }

      function addEntry(entry, zipObj, path = '') {
        if (entry.type === 'file') {
          return fetch(entry.download_url)
            .then(r => { if (!r.ok) throw new Error(r.status); return r.blob(); })
            .then(b => zipObj.file(path + entry.name, b));
        }
        if (entry.type === 'dir') {
          const dir = zipObj.folder(entry.name);
          return fetch(`https://api.github.com/repos/${owner}/${repo}/contents/list/${path}${entry.name}?ref=${branch}`, { headers: { 'Accept': 'application/vnd.github.v3+json' } })
            .then(r => { if (!r.ok) throw new Error(r.status); return r.json(); })
            .then(children => Promise.all(children.map(c => addEntry(c, dir, path + entry.name + '/'))));
        }
      }

      function zipAndDownload(item) {
        const zip = new JSZip();
        addEntry(item, zip)
          .then(() => zip.generateAsync({ type: 'blob' }))
          .then(blob => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${item.name.replace(/\.[^/.]+$/, '')}.zip`;
            document.body.appendChild(link);
            link.click();
            link.remove();
            setTimeout(() => URL.revokeObjectURL(url), 10000);
          })
          .catch(err => showError('Zip or download failed: ' + err.message));
      }
    });
  </script>
</body>
</html>
